---
title: "[三] 内置类型"
author: all_nan
date: 2019-09-10 11:24:09
---

## 内置类型

Dart 语言内置了以下几种类型，并且提供了特殊支持

- numbers
- strings
- booleans
- lists (arrays)
- sets
- maps
- runes (用 string 表达 Unicode 字符)
- symbols

你可以用字符值来初始化这些特殊类型，像是`this is a string`是一个字符串字符值，`true`是一个布尔字符值。

由于 Dart 中所有的变量都是一个对象---是类的一个实例，所以你通常可以用构造函数来初始化变量。有一部分内置类型有他们自己的构造器。例如你可以用`Map()`构造器来创造一个 map 对象。

### Numbers-数值

Dart 中有两种数值类型：

- int
  Integer（整型）值最大支持 64 位（这取决于运行的平台）。在 Dart 虚拟机上，Integer 值的范围是`-2^63` - `2^63^-1`，编译到 JavaScript 时使用 JavaScript 的数值，数值范围是`-2^53` - `2^53^-1`。

- double
  64 位的双精度浮点数值，遵循 IEEE 754 标准。

int 和 double 都是 num 的子类，数值类型包含了基本的操作符如`+`，`-`，`*`，和`/`，还有`abs()`，`ceil()`，`floor()`，和其他方法也适用于数值类型的机算（像`>>`这种位运算符，被定义在了 int 类中）。如果 num 和它的字类中没有你要找的，试试在[dart:math](https://api.dart.dev/stable/2.5.0/dart-math/dart-math-library.html)库中找找。

Integer（整型）数值是没有小数点的数字，例如：

```Dart
var x = 1;
var hex = 0xADDE335;
```

如果一个数中包含了小数点，它就是一个 double 数值，例：

```Dart
var y = 0.1;
var exponents = 1.1e9;
```

从 Dart2.1 开始，在必要的时候，整型数值会自动转化为 double 数值。

```Dart
double d = 1;//等同于double d = 1.0;
```

::: tip Version Note
版本说明：在 Dart <Badge text="2.1"/> 之前，在 double 上下文中使用一个整数字面量会引发一个错误。
:::

下面是 string 和 number 类型互转的例子：

```Dart
// String -> int
var one = int.parse('1');
assert(one == 1);//pass

// String -> double
var onePointOne = double.parse('1.1');
assert(onePointOne == 1.1);//pass

// int -> String
String oneAsString = 1.toString();
assert(oneAsString == '1');//pass

// double -> String
String piAsString = 3.14159.toStringAsFixed(2);
assert(piAsString == '3.14');//pass
```

整型数值支持传统的位运算`<<`，`>>`，AND(&),and OR(|)操作符，例如：

```Dart
assert((3 << 1) == 6); // 0011 << 1 == 0110
assert((3 >> 1) == 1); // 0011 >> 1 == 0001
assert((3 | 4) == 7); // 0011 | 0100 == 0111
```

以字符值定义的数值都是编译时常量，许多算术表达式也是编译时常量，只要他们的操作数是编译时常量且最后得到一个数值。

```Dart
const msPerSecond = 1000;
const secondsUntilRetry = 5;
const msUntilRetry = secondsUntilRetry * msPerSecond;//pass
```

### String-字符串

Dart 重得字符串是以 UTF-16 编码单元组成的序列，可以用单引号也可以用双引号包括文字来创建一个字符串。

```Dart
var s1 = 'Single quotes work well for string literals.';
var s2 = "Double quotes work just as well.";
var s3 = 'It\'s easy to escape the string delimiter.';
var s4 = "It's even easier to use the other delimiter.";
```

在字符串中，可以用`${expression}`的形式插入表达式。如果表达式是一个变量名，可以省略`{}`。Dart 会调用对象方法的 toString()方法来获取相应的 String 值。

```Dart
var s = 'string interpolation';

assert('Dart has $s, which is very handy.' ==
    'Dart has string interpolation, ' +
        'which is very handy.');
assert('That deserves all caps. ' +
        '${s.toUpperCase()} is very handy!' ==
    'That deserves all caps. ' +
        'STRING INTERPOLATION is very handy!');
```

_`==`操作符用来判断两个对象是否相同，如果两个 string 拥有相同的编码序列，则认为这两个 string 是相同的。_

可以用`+`来把字符串连接起来。

```Dart
var s1 = 'String '
    'concatenation'
    " works even over line breaks.";
assert(s1 ==
    'String concatenation works even over '
        'line breaks.');

var s2 = 'The + operator ' + 'works, as well.';
assert(s2 == 'The + operator works, as well.');
```

(除了\n)还有一个方法来创建多行字符串：使用三个引号（单引号或者双引号）。

```Dart
var s1 = '''
You can create
multi-line strings like this one.
''';

var s2 = """This is also a
multi-line string.""";
```

在字符串前面加上一个`r`会得到一个“原始的”字符串（所见即所得，不会转义字符）

```Dart
var s = r'In a raw string, not even \n gets special treatment.';
```

字符串是编译时常量，如果包含插值表达式，只要这些插值表达式能够得出 null、数字、字符串或者布尔值，这个插值表达式也是编译时常量，这个字符串也是。

```Dart
// These work in a const string.
const aConstNum = 0;
const aConstBool = true;
const aConstString = 'a constant string';

// These do NOT work in a const string.
var aNum = 0;
var aBool = true;
var aString = 'a string';
const aConstList = [1, 2, 3];

const validConstString = '$aConstNum $aConstBool $aConstString';
// const invalidConstString = '$aNum $aBool $aString $aConstList';
```

_更多信息和 string 的使用方法，请参考[String 和正则表达式](https://dart.dev/guides/libraries/library-tour#strings-and-regular-expressions)篇_

### Booleans-布尔

Dart 内置了一个`bool`的类型来表示布尔值。只有两个对象属于布尔值，布尔字符值：`true`和`false`，两者都是编译时常量。

Dart 是类型安全的，一位置你不可以这样写代码`if (nonbooleanValue)`或者`assert (nonbooleanValue)`。需要明确地检查值

```Dart
// Check for an empty string.
var fullName = '';
assert(fullName.isEmpty);

// Check for zero.
var hitPoints = 0;
assert(hitPoints <= 0);

// Check for null.
var unicorn;
assert(unicorn == null);

// Check for NaN.
var iMeantToDoThis = 0 / 0;
assert(iMeantToDoThis.isNaN);

```


### Lists-列表

绝大多数计算机语言最通用的集合也许就是 array（数组）或者有序对象组了。在 Dart 中，array 数组是 List 对象，大多数人直接叫数组为 lists。

Dart 中的 list 看起来像 JavaScript 中的数组，下面是 Dart list 示例

```Dart
var list = [1, 2, 3];
```

_Dart 推断上面的 list 类型是 list\<int\>,如果你试图加入一个非 integer 对象进入该 lists，分析器或者运行的时候就会返回一个错误。参考[类型推断](https://dart.dev/guides/language/sound-dart#type-inference)_

Lists 从 0 开始索引，Lists 中的第一个元素的索引是 0，最后一个元素的索引是 list.length - 1。可以用和 JavaScript 同样的方法来
获取 list 的长度和元素：

```Dart
var list = [1, 2, 3];
assert(list.length == 3);
assert(list[1] == 2);

list[1] = 1;
assert(list[1] == 1);
```

#### 如果打算创建一个编译常量的列表，在列表字符值前面加上 const

```Dart
var constantList = const [1, 2, 3];
// constantList[1] = 1; // Uncommenting this causes an error.
```

Dart<Badge text="2.3"/> 版本开始引入了扩展操作符`...`和空值感知扩展操作符`...?`，可以很方便地向一个集合中插入多个元素。你可以用扩展操作符将一个 list 地元素全部插入另一个 list 中：

```Dart
var list = [1, 2, 3];
var list2 = [0, ...list];
assert(list2.length == 4);
```

#### 如果要插入的 list 可能是 null，你可以用空值感知拓展操作符`...?`来避免出现错误

```Dart
var list;
var list2 = [0, ...?list];
assert(list2.length == 1);
```

_更多拓展操作符相关的细节，参阅[扩展操作符建议](https://github.com/dart-lang/language/blob/master/accepted/2.3/spread-collections/feature-specification.md)_

#### Dart2.3 也引入了`collection if`和`collection for`，分别用来根据情况构建集合或者循环构建集合

- collection if 根据掉件选择是否添加某个元素

```Dart
var nav = [
  'Home',
  'Furniture',
  'Plants',
  if (promoActive) 'Outlet'
];
```

- collection for 循环遍历添加元素

```Dart
  var listOfInts = [10, 20, 30];
  var listOfStrings = [
    '*0',
    for (var i in listOfInts) '*$i'
  ];

  print(listOfStrings);
  //输出
  [*0, *10, *20, *30]
```

_`collection if` 和 `collection for` 的更多用法，请[集合流控制提案](https://github.com/dart-lang/language/blob/master/accepted/2.3/control-flow-collections/feature-specification.md)_

_List 类内置了很多操作列表的方法，参考[泛型](https://dart.dev/guides/language/language-tour#generics)和[集合](https://dart.dev/guides/libraries/library-tour#collections)_

### Sets-无序唯一集合

Dart 中 set 是无序并且元素唯一的一个集合。Dart 通过 set 字符值和 Set 类型来定义和支持 Set 类型。

::: tip Version Note
虽然Set类型一直是Dart核心库的一部分，但是set字符值是Dart<Badge text="2.2"/>以后才被引入的。
:::

例：用set字符值来创建Dart set对象

``` Dart
var sins = {'Pride', 'Envy', 'Gluttony', 'Lust', 'Anger', 'Greed', 'Sloth'};
```

::: tip 
Dart推断`sins`的类型为`Set<String>`，如果试图加入错误的类型，分析器或者运行时就会抛出一个错误。更多信息请参阅[类型推断](https://dart.dev/guides/language/sound-dart#type-inference)
:::

#### 可以用`{}`来创建一个空set，但是要对`{}`指定一个类型，或者将`{}`指向一个带类型的Set

```Dart
var names = <String>{}; //对{}指定类型
set<String> names = {}; // 将{}指向一个带类型的set.
var names = {}; // 这将得到一个map，而不是set.
```

::: tip Set or Map
Set和Map的字符值语法很相近，这是因为Map字符值的优先级更高。{}默认为Map类型。如果忘记了对{}进行类型声明，或者忘了对{}指向的变量声明类型，Dart会将这个{}指向的对象创建为`Map<dynamic, dynamic>`类型。
:::

#### 向一个已存在的Set对象里添加项目，可以用`add()`或者`addAll()`方法

```Dart
var elements = <String>{};
elements.add('fluorine');
elements.addAll(halogens);
```

#### 调用`set.length`来获取set中的项目数

```Dart
var elements = <String>{};
elements.add('fluorine');
elements.addAll(halogens);
assert(elements.length == 5);
```

#### 用`const`来修饰set字符值，以创造一个编译时常量

```Dart
final constantSet = const {'Pride', 'Envy', 'Gluttony', 'Lust', 'Anger', 'Greed', 'Sloth'};
// constantSet.add('Conceit'); // 这行代码不会通过编译
```

从Dart<Badge text="2.3"/>开始，set和list一样支持扩展运算符`...`(拓展操作符)和`...?`(空间感知扩展操作符),并且也支持`ifs`和`fors`这两个集合操作。更多信息请参阅[列表扩展操作符](https://dart.dev/guides/language/language-tour#spread-operator)和[列表集合操作符](https://dart.dev/guides/language/language-tour#collection-operators)的相关讨论。

更多set的相关资料请参阅[泛型](https://dart.dev/guides/language/language-tour#generics)和[Sets](https://dart.dev/guides/libraries/library-tour#sets)

### Maps

通常来说，一个map对象是由复数和相关联的键值对组合而成的。键和值都可以是任意类型，每一个键只会在一个map中出现一次，但是同样的值可以出现多次，Dart支持用Dart字符值和Map类来`提供/产出/声明`map变量。

#### 用map字符值来创建Dart map对象的例子

```Dart
var gifts = {
  // Key:    Value
  'first': 'partridge',
  'second': 'turtledoves',
  'fifth': 'golden rings'
};

var nobleGases = {
  2: 'helium',
  10: 'neon',
  18: 'argon',
};
```

::: tip NOTE
上述代码中，Dart推断gifts是Map<String, String>类型的，而nobleGases是Map<int, String>类型的。如果试图添加一个错误的类型，分析器或者运行时就会抛出一个错误。更多信息请参阅[类型推断](https://dart.dev/guides/language/sound-dart#type-inference)
:::

#### 也可以使用Map构造器来创建一个map对象

```Dart
var gifts = Map();
gifts['first'] = 'partridge';
gifts['second'] = 'turtledoves';
gifts['fifth'] = 'golden rings';

var nobleGases = Map();
nobleGases[2] = 'helium';
nobleGases[10] = 'neon';
nobleGases[18] = 'argon';
```

:::tip
你可能以为会用`new Map()`而不是`Map()`，从Dart<Badge text="2"/>开始，`new`关键词是可选择的。
:::